<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Plankan timer</title>

    <link rel="stylesheet" type="text/css" href="plankton.css">

    <script type="text/javascript" src="howler.js/howler.min.js"></script>
    <script type="text/javascript">

        function getCheerfulPhrase() {
            var phrases = ['Keep on!', 'Good work!', 'Be strong!', 'Live long and prosper.', 'All is well.', 'Remain cheerful!',
            'Be positive.', ' Stay happy', 'Hakuna matata!', 'The greatest wealth is health.', 'Eat right, exercise regularly',
            'Health is happiness.', 'A good laugh and a long sleep are the best cures in the doctor\'s book.'];
            var i = Math.trunc(phrases.length * Math.random());
            return phrases[i];
        }

        function speak(text, callback) {
            var u = new SpeechSynthesisUtterance();
            u.text = text;
            u.lang = 'en-US';

            u.onend = function () {
                if (callback) {
                    callback();
                }
            };

            u.onerror = function (e) {
                if (callback) {
                    callback(e);
                }
            };

            speechSynthesis.speak(u);
        }

        function speakAt(inSeconds, text, callback) {
            setTimeout(function () {
                speak(text, callback)
            }, inSeconds * 1000);
        }

        function startPlankan() {
            var sound = new Howl({
                urls: ['Intercom-beep-sound.mp3']
            });
            var backgroundSound = new Howl({
//                urls: ['http://goldfirestudios.com/proj/howlerjs/sound.ogg'],
                urls: ['output.ogg'],
                autoplay: false,
                loop: true,
                volume: 0.5
            });
            var backgroundSoundRelax = new Howl({
                urls: ['output.ogg'],
                autoplay: false,
                loop: true,
                volume: 0.2
            });
            var applause = new Howl({
                urls: Math.random() > 0.05 ? ['SMALL_CROWD_APPLAUSE.mp3'] : ['FakeApplause.mp3'],
                autoplay: false,
                loop: false,
                volume: 0.2
            });

            var t = 0;
            var BACKGROUND_VOLUME = 0.1;
            speakAt(t+=0, "Hi! Plankan will start in.", function () {backgroundSoundRelax.pause().fadeIn(BACKGROUND_VOLUME, 4000);});
            speakAt(t+=1, "Three");
            speakAt(t+=1, "Two");
            speakAt(t+=1, "One");
            speakAt(t+=1, "Start!", function () {sound.play();backgroundSound.pause().fadeIn(BACKGROUND_VOLUME, 4000);});
            speakAt(t+=40, "Twenty left!");
            speakAt(t+=19, "Three!", function () {backgroundSound.pause().fadeOut(0, 2000);});
            speakAt(t+=1, "Two!");
            speakAt(t+=1, "One!");
            speakAt(t+=1, "Change!");

            speakAt(t+=1, "Start side plank!",function () {sound.play();});
            speakAt(t+=10, "Keep on!");
            speakAt(t+=10, getCheerfulPhrase());
            speakAt(t+=15, "Ten left!");
            speakAt(t+=8, "Three!");
            speakAt(t+=1, "Two!");
            speakAt(t+=1, "One!");
            speakAt(t+=1, "Change!");

            speakAt(t+=1, "Start plank!", function () {sound.play();backgroundSound.pause().fadeIn(BACKGROUND_VOLUME, 4000);});
            speakAt(t+=40, "Twenty left!");
            speakAt(t+=19, "Three!", function () {backgroundSound.pause().fadeOut(0, 2000);});
            speakAt(t+=1, "Two!");
            speakAt(t+=1, "One!");
            speakAt(t+=1, "Change!");

            speakAt(t+=1, "Start side plank!", function () {sound.play();});
            speakAt(t+=20, "Good work!");
            speakAt(t+=15, "Ten left!");
            speakAt(t+=8, "Three!");
            speakAt(t+=1, "Two!");
            speakAt(t+=1, "One!");
            speakAt(t+=1, "Change!");

            speakAt(t+=1, "Start plank!", function () {sound.play();backgroundSound.pause().fadeIn(BACKGROUND_VOLUME, 4000);});
            speakAt(t+=40, "Twenty left!");
            speakAt(t+=19, "Three!", function () {backgroundSound.pause().fadeOut(0, 2000);});
            speakAt(t+=1, "Two!");
            speakAt(t+=1, "One!");
            speakAt(t+=1, "Finished!");
            speakAt(t+=2, "Great work!", function () {applause.play();backgroundSoundRelax.pause().fadeOut(0, 1000);});

        }
</script>
</head>
    <div class="container">
        <div class="header">Plankton -- the "plankan" timer</div>
        <div class="mainbody">
            <div>1 min</div>
            <div>45s pause</div>
            <div>1 min</div>
            <div>45s pause</div>
            <div>1 min</div>
        </div>
        <input id="Start" type="button" value="Start plankan" onclick="startPlankan()" />
        <div class="footer">Be the plank!</div>
        <a href="http://jsfiddle.net/c38okrs4/12/"/>
    </div>
</body>
</html>